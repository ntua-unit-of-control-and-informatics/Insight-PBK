theta.post <- rep(NA, steps)
# start
theta.post[1] <- inits
for (t in 2:steps){
# propose candidate value for prob of success
theta_star <- move(theta.post[t-1], away = away)
# calculate ratio R
pstar <- posterior(survived, p = theta_star)
pprev <- posterior(survived, p = theta.post[t-1])
logR <- pstar - pprev
R <- exp(logR)
# accept candidate value or keep current value (step 4)
X <- runif(1, 0, 1) # spin continuous spinner
if (X < R){
theta.post[t] <- theta_star
}
else{
theta.post[t] <- theta.post[t-1]
}
}
theta.post
}
theta.post2 <- metropolis(steps = 100, inits = 0.2)
df2 <- data.frame(x = 1:steps, y = theta.post2)
ggplot() +
geom_line(data = df, aes(x = x, y = y), size = 1.5, color = wesanderson::wes_palettes$Zissou1[1]) +
geom_line(data = df2, aes(x = x, y = y), size = 1.5, color = wesanderson::wes_palettes$Zissou1[3]) +
labs(x = "iterations", y = "values from posterior distribution") +
ylim(0.1, 0.6)
ggplot() +
geom_line(data = df, aes(x = x, y = y), size = 1.5, color = wesanderson::wes_palettes$Zissou1[1]) +
geom_line(data = df2, aes(x = x, y = y), size = 1.5, color = wesanderson::wes_palettes$Zissou1[3]) +
labs(x = "iterations", y = "values from posterior distribution") +
ylim(0.1, 0.6)
steps <- 5000
set.seed(1234)
theta.post <- metropolis(steps = steps, inits = 0.5)
df <- data.frame(x = 1:steps, y = theta.post)
df %>%
ggplot() +
geom_line(aes(x = x, y = y), size = 1, color = wesanderson::wes_palettes$Zissou1[1]) +
labs(x = "iterations", y = "values from posterior distribution") +
ylim(0.1, 0.6) +
geom_hline(aes(yintercept = mean(theta.post), linetype = "posterior mean")) +
scale_linetype_manual(name = "", values = c(2,2))
steps <- 1000
theta.post <- metropolis(steps = steps, inits = 0.99)
df <- data.frame(x = 1:steps, y = theta.post)
df %>%
ggplot() +
geom_line(aes(x = x, y = y), size = 1.2, color = wesanderson::wes_palettes$Zissou1[1]) +
labs(x = "iterations", y = "survival") +
theme_light(base_size = 14) +
annotate("rect",
xmin = 0,
xmax = 100,
ymin = 0.1,
ymax = 1,
alpha = .3) +
scale_y_continuous(expand = c(0,0))
#Chain length
# inspired from https://bookdown.org/content/3686/markov-chain-monte-carlo.html
n_steps <- 10000
d <-
tibble(away = c(0.1, 1, 10)) %>%
mutate(accepted_traj = map(away, metropolis, steps = n_steps, inits = 0.1)) %>%
unnest(accepted_traj)
n_steps <- 10000
d <-
tibble(away = c(0.1, 1, 10)) %>%
mutate(accepted_traj = map(away, metropolis, steps = n_steps, inits = 0.1)) %>%
unnest(accepted_traj)
n_steps <- 10000
d <-
tibble(away = c(0.1, 1, 10)) %>%
mutate(accepted_traj = map(away, metropolis, steps = n_steps, inits = 0.1)) %>% unnest(accepted_traj)
(40+54)/2
(36+48)/2
767.5/64.1
0.21e
0.21e-2
0.768/64.1
(0.03+0.08+0.1+0.2)/4
1-0.68-0.3
(300+1000)/2
BW = 70
#Lung
PVLu <- 0.76e-2 #Brown et al. 1997, Table 7
VLu <- PVLu * BW
PVLuB <- 0.58 #pkSim
VLuB <- PVLuB * PVLu * BW #Brown et al. 1997, p 459 --> capillary blood occupied 9% of the lung volume
PVLuF <- 0.19 #pkSim
VLuF <- PVLuF * PVLu * BW #lung interstitial fluid volume
PVLuELF <- ??
VLuELF <- PVLuELF * BW #lung alveolar lining fluid volume kg=LL
VLu
BW
VLu
VLuB
VLuF
PVLuELF <- 36e-3/70
VLuELF <- PVLuELF * BW #lung alveolar lining fluid volume kg=LL
VLuT <- VLu - VLuF - VLuELF #lung tissue volume kg=L
VLuELF
#Lung
PVLu <- 0.76e-2 #Brown et al. 1997, Table 7
VLu <- PVLu * BW
PVLuB <- 0.58 #pkSim
VLuB <- PVLuB * PVLu * BW #Brown et al. 1997, p 459 --> capillary blood occupied 9% of the lung volume
PVLuF <- 0.19 #pkSim
VLuF <- PVLuF * PVLu * BW #lung interstitial fluid volume
PVLuELF <- 36e-3/70 #70 is assumptions, the value is reported as an estimation, https://doi.org/10.3389/fphys.2012.00146
VLuELF <- PVLuELF * BW #lung alveolar lining fluid volume kg=LL
VLuT <- VLu - VLuF - VLuELF #lung tissue volume kg=L
#Spleen (ok)
PVSP <- 0.26e-2  #Brown et al. 1997, p 416, Table 7
VSP <- PVSP * BW
PVSPB <- 0.33 #pkSim
VSPB <- PVSPB * PVSP * BW #volume of the blood of spleen kg=L
PVSPF <- 0.15 #pkSim
VSPF <- PVSPF * PVSP * BW #spleen interstitial fluid volume kg=L
VSPT <- VSP - VSPF #spleen tissue volume kg=L
VSPB
VSPF
PVLuF
#Heart (ok)
PVH <- 0.47e-2  #Brown et al. 1997, p 416, Table 7
VH <- PVH * BW
PVHB <- 0.14 #pkSim
VHB <- PVHB * PVH * BW #volume of the blood of heart kg=L
PVHF <- 0.10 #pkSim
VHF <- PVHF * PVH * BW #heart interstitial fluid volume kg=L
VHT <- VH - VHF #heart tissue volume kg=L
VHB
VSPB
VLuB
VLuELF
Qcardiac
Qcardiac <- 5.2 * (BW^0.75) *60 #L/min->*60-> L/h, Brown et al. 1997, p 438, Table 22
PQBK <- 17.5/100 #Brown et al. 1997, p 438, Table 23
QBK <- PQBK * Qcardiac #L/h
PQBL <- 22.7/100
Qcardiac
0.07/Qcardiac
Qcardiac?60
Qcardiac/60
0.07/125.8424
0.0005562513*100
0.07*60
4.2/7550.542
0.0005562515/100
0.0005562515*100
PQBST <- 0.056/100 #from pKsim 0.07 L/min for a 70 kg human --> calculation of the fraction of cardiac output
QBST <- PQBST * Qcardiac #L/h
QBST
13.05*1e-3*3600
(11077*1e-6 )*11020*2
claude
# ============================================================================
# Scholten et al. 2023 - PBK Model for TDI Exposure
# ============================================================================
#amount in ug
#concentration in ug/L
#Kg=L
setwd("Scholten et al.2023")
library(deSolve)
library(ggplot2)
library(jaqpotr)
#=========================
#1. Parameters of the model
#=========================
create.params <- function(user.input){
with(as.list(user.input),{
# ============================================================================
#Physiological Parameters
# ============================================================================
#Chemical specific parameters
# ============================================================================
#Molecular weights (g/mol)
MW <- 174.16
MWmet <- 122.17
LogP <- 3.74
VP <- 2.7 #vapor pressure, Pa
Talbmcr_TDI <- 0.167 #TDI Half-life of binding to albumin and other macromolecules, h
Falb <- 0.2 #Proportion bound to albumin (%)
Tvas_TDI <- 0.083 #TDI Half-life transfer from lung interstitial to lung vascular, h
# ============================================================================
# Body weight (kg)
BW <- 85
#Hematocrit (%)
Fhem <- 0.45
# ============================================================================
# Tissue fractional volumes
VFbld <- 0.073 #Blood
VFlun <- 0.015 # Liver
VFskn <- 0.045 #Skin
VFgut <- 0.016 #Gut
VFlumen <- 0.9 #Gut lumen
VFkidney <- 0.004  #Kidney volume
#Excretion parameters
Tfeces <- 2.3 #1/h, Half-life transfer lumen to feces
UPR <- 0.00125 #urine production, L/kg/h
Ccreat <- 1 #creatinine in urine, g/L
Telim <- 456 #Half-life elimination from albumin, h
#Skin parameters
SAderm <- 100 #Exposed surface area of skin, cm2
Hscve <- 0.012 #Height of skin barrier, cm
Hsurf <- 0.01 #Height of skin surface, cm
Fatepi <- 0.02 #Fraction of fat in epidermis
Fatbld <- 0.07 #Fraction of fat in blood
Talb_scve <- 2.8*10-6 #Half-life of binding to albumin in scve, H
#============================================================================================
#Flow rates (L/h)
#============================================================================================
Qc <- 390 #cardiac output
Qgfr <- 5.5 #glomerular filtration rate
# Fractional blood flows to tissue blood flow
QFskn <- 0.05   #Skin
QFgut <- 0.15  #Gut
#Blood flows
Qupr <- UPR*BW #Urine production rate, L/h
Qgut <- QFgut*Qc #Blood flow to the gut, L/h
Qskn <- QFskn*Qc #Blood flow to the skin, L/h
#Fat-content adjusted stratum corneum permeability coefficient transferred into a clearance value, L/h
Qscve <- 100.74*LogP - 0.006*MW - 2.8 *SAderm/1000
# ============================================================================
# Calculated Parameters
# ============================================================================
#Binding constants
#=============================================================================
Kvas_TDI <- log(2)/Tvas_TDI #TDI Transfer rate constant for transfer from the interstitial to the vascular lung compartment, 1/h
Kalb_TDI <- Falb*log(2)/Talbmcr_TDI #TDI Binding rate constants for binding of unbound diisocyanates to albumin, 1/h
Kmcr_TDI <- (1-Falb)*(log(2)/Talbmcr_TDI) #TDI Binding rate constants for binding of unbound diisocyanates to macromolecules, 1/h
Kelim <- log(2)/Telim #Elimination rate constant for the degradation of albumin into (smaller) macromolecules), 1/h
Thydro <- 1.0  # Half-life for hydrolysis (assumed value), h
khydro <- log(2)/Thydro #Rate constant for hydrolysis of unbound diisocyanates, 1/h
Kfeces <- log(2)/Tfeces #Transfer rate constant from the gut lumen to the feces, 1/h
Kalb_scve <- log(2)/Talb_scve #Binding rate constant of binding to albumin in the skin
Pbld_scve <- (1-Fatepi + Fatepi*10^LogP)/(1-Fatbld + Fatbld* 10^LogP) #Skin barrier (stratum corneum + viable epidermis) to blood partition coefficient
# Tissue volumes (L)
#=============================================================================
Vbld <- VFbld * BW
Vlun <- VFlun * BW
Vskn <- VFskn * BW
Vgut <- VFgut * BW
Vkidney <- VFkidney * BW
Vscve <- SAderm * Hscve / 1000  # Skin barrier volume (L)
Vsurf <- SAderm * Hsurf / 1000  # Skin surface volume (L)
Vrem <- BW - Vbld - Vlun - Vskn - Vgut - Vkidney  # Remaining tissue volume
#==========================================================================================================================
#Other parameters
#==========================================================================================================================
#Evaporation parameters
#kevap = cevap * (MW*8.7*VP*SAderm)/8.314*303*10
# Additional parameters needed for simulation
Dderm_ub <- 0  # Dermal deposition rate (mg/h/cm2)
Qoral <- 0  # Oral dose rate (mg/h)
Kabs <- 1   # Absorption rate constant from gut lumen (1/h)
Qkid <- 0.2 * Qc  # Kidney blood flow (L/h)
Vscve <- SAderm * Hscve / 1000  # Skin barrier volume (L)
Vsurf <- SAderm * Hsurf / 1000  # Skin surface volume (L)
return(list(
'MW'=MW, 'MWmet'=MWmet, 'LogP'=LogP, 'VP'=VP,
'Talbmcr_TDI'=Talbmcr_TDI, 'Falb'=Falb,
'Tvas_TDI'=Tvas_TDI, 'BW'=BW,
'VFbld'=VFbld, 'VFlun'=VFlun, 'VFskn'=VFskn, 'VFgut'=VFgut, 'VFlumen'=VFlumen,
'VFkidney'=VFkidney, 'Qc'=Qc, 'Qgfr'=Qgfr, 'QFskn'=QFskn, 'QFgut'=QFgut,
'Tfeces'=Tfeces, 'UPR'=UPR, 'Ccreat'=Ccreat, 'Telim'=Telim,
'SAderm'=SAderm, 'Hscve'=Hscve, 'Hsurf'=Hsurf, 'Fatepi'=Fatepi, 'Fatbld'=Fatbld,
'Talb_scve'=Talb_scve, 'Kvas_TDI'=Kvas_TDI, 'Kalb_TDI'=Kalb_TDI,
'Kmcr_TDI'=Kmcr_TDI, 'Kelim'=Kelim,
'Thydro'=Thydro, 'khydro'=khydro, 'Kfeces'=Kfeces, 'Kalb_scve'=Kalb_scve,
'Pbld_scve'=Pbld_scve, 'Qscve'=Qscve, 'Qupr'=Qupr, 'Qgut'=Qgut,
'Qskn'=Qskn, 'Dderm_ub'=Dderm_ub, 'Qoral'=Qoral, 'Kabs'=Kabs,
#'kevap'=kevap,
'Vbld'=Vbld, 'Vlun'=Vlun, 'Vskn'=Vskn, 'Vgut'=Vgut, 'Vkidney'=Vkidney,
'Vscve'=Vscve, 'Vsurf'=Vsurf, 'Vrem'=Vrem,
'Qkid'=Qkid, 'Vscve'=Vscve, 'Vsurf'=Vsurf,
'Fabs'=Fabs, 'inhalation'=inhalation, 'inhalation_time'=inhalation_time
))
})
}
#===============================================
#2. Function to create initial values for ODEs
#===============================================
create.inits <- function(parameters){
with(as.list(parameters),{
Alung_int_ub <-0 ; Alung_int_alb <-0  ; Alung_int_mcr <-0 ;
Alung_vas_ub <-0 ; Alung_vas_alb <-0 ; Alung_vas_mcr <-0 ;
Aart_ub <-0 ; Aart_alb <-0 ; Aart_mcr <-0 ; Aven_ub <-0;
Aven_alb <-0 ; Aven_mcr <-0 ; Derm <-0; Asurf_ub <-0 ; Ascve_ub <-0 ;
Ascve_alb <-0 ; Ascve_mcr <-0 ; Askn_ub <-0 ; Askn_mcr <-0 ;
Alum <-0 ; Akid_ub <-0 ; Akid_mcr <-0 ; Auri_amine <-0; Aurine <-0 ;
Afeces <-0 ; Arem_ub <-0 ; Vuri <-0 ; inhalation <- 0
return(c(
'Alung_int_ub' =  Alung_int_ub, 'Alung_int_alb' =  Alung_int_alb, 'Alung_int_mcr'= Alung_int_mcr,
'Alung_vas_ub'= Alung_vas_ub, 'Alung_vas_alb'= Alung_vas_alb, 'Alung_vas_mcr'= Alung_vas_mcr,
'Aart_ub'= Aart_ub, 'Aart_alb'= Aart_alb, 'Aart_mcr'= Aart_mcr, 'Aven_ub'= Aven_ub,
'Aven_alb'= Aven_alb, 'Aven_mcr'= Aven_mcr, 'Derm'=Derm, 'Asurf_ub'= Asurf_ub, 'Ascve_ub'= Ascve_ub,
'Ascve_alb'= Ascve_alb, 'Ascve_mcr'= Ascve_mcr, 'Askn_ub'= Askn_ub, 'Askn_mcr'= Askn_mcr,
'Alum'= Alum, 'Akid_ub'= Akid_ub, 'Akid_mcr'= Akid_mcr, 'Auri_amine'=Auri_amine, 'Aurine'= Aurine,
'Afeces'= Afeces, 'Arem_ub'= Arem_ub, 'Vuri'= Vuri, "inhalation" = inhalation
))
})
}
#================================================================================================
#===================
#3. Events function
#===================
create.events <- function(parameters){
with(as.list(parameters), {
ldose <- length(inhalation)
ltimes <- length(inhalation_time)
# If not equal, then stop
if (ltimes != ldose){
stop("The times of administration should be equal in number to the doses")
}else{
events <- list(data = data.frame(var = c("inhalation"),  time = inhalation_time,
value = inhalation, method = c("rep")))
}
return(events)
})
}
#================================================================================================
#==================
#4. Custom function
#==================
custom.func <- function(){
return()
}
# ============================================================================
#5. ODEs System
# ============================================================================
ode.func <- function(time, inits, params, custom.func){
with(as.list(c(inits, params)),{
# Concentrations (mg/L) for all fractions
Clung_int_ub <- Alung_int_ub / Vlun
Clung_int_alb <- Alung_int_alb / Vlun
Clung_int_mcr <- Alung_int_mcr / Vlun
Clung_vas_ub <- Alung_vas_ub / Vlun
Clung_vas_alb <- Alung_vas_alb / Vlun
Clung_vas_mcr <- Alung_vas_mcr / Vlun
Cart_ub <- Aart_ub / Vbld
Cart_alb <- Aart_alb / Vbld
Cart_mcr <- Aart_mcr / Vbld
Cven_ub <- Aven_ub / Vbld
Cven_alb <- Aven_alb / Vbld
Cven_mcr <- Aven_mcr / Vbld
Cskn_ub <- Askn_ub / Vskn
Cskn_mcr <- Askn_mcr / Vskn
Clum <- Alum / Vgut
Cscve_ub <- Ascve_ub / Vscve
Cscve_mcr <- Ascve_mcr / Vscve
Csurf_ub <- Asurf_ub / Vsurf
Ckid_ub <- Akid_ub / Vkidney
Ckid_mcr <- Akid_mcr / Vkidney
Crem_ub <- Arem_ub / Vrem
Curine <- Aurine / Vuri
Curine_amine <- Auri_amine / Vuri
# ========== LUNG COMPARTMENT ==========
# Lung Interstitial - Unbound
dAlung_int_ub <- inhalation*Fabs - Kalb_TDI * Alung_int_ub - Kmcr_TDI * Alung_int_ub -
Kvas_TDI * Alung_int_ub
# Lung Interstitial - Albumin-bound
dAlung_int_alb <- Kalb_TDI * Alung_int_ub - Kelim * Alung_int_alb - Kvas_TDI * Alung_int_alb
# Lung Interstitial - Macromolecule-bound
dAlung_int_mcr <- Kmcr_TDI * Alung_int_ub + Kelim * Alung_int_alb - Kvas_TDI * Alung_int_mcr
# Lung Vascular - Unbound
dAlung_vas_ub <- Kvas_TDI * Alung_int_ub - Kalb_TDI * Alung_vas_ub - Kmcr_TDI * Alung_vas_ub +
Qc * Cven_ub - Qc * Clung_vas_ub
# Lung Vascular - Albumin-bound
dAlung_vas_alb <- Kvas_TDI * Alung_int_alb + Kalb_TDI * Alung_vas_ub - Kelim * Alung_vas_alb +
Qc * Cven_alb - Qc * Clung_vas_alb
# Lung Vascular - Macromolecule-bound
dAlung_vas_mcr <- Kvas_TDI * Alung_int_mcr + Kmcr_TDI * Alung_vas_ub + Kelim * Alung_vas_alb +
Qc * Cven_mcr - Qc * Clung_vas_mcr
# ========== BLOOD COMPARTMENTS ==========
# Arterial Blood - Unbound
dAart_ub <- Qc * Clung_vas_ub - Qc * Cart_ub - Qskn * Cart_ub - Qkid * Cart_ub -
Kalb_TDI*Aart_ub - Kmcr_TDI*Aart_ub
# Arterial Blood - Albumin-bound
dAart_alb <- Qc * Clung_vas_alb - Qc * Cart_alb + Kalb_TDI*Aart_ub - Kelim*Aart_alb
# Arterial Blood - Macromolecule-bound
dAart_mcr <- Qc * Clung_vas_mcr - Qc * Cart_mcr - Qskn * Cart_mcr - Qkid * Cart_mcr +
Kmcr_TDI*Aart_ub + Kelim*Aart_alb
# Venous Blood - Unbound
dAven_ub <- Qskn * Cskn_ub + Qc * Crem_ub + Qkid * Ckid_ub - Qc * Cven_ub - Kalb_TDI*Aven_ub - Kmcr_TDI*Aven_ub
# Venous Blood - Albumin-bound
dAven_alb <- Qc * Cart_alb - Qc * Cven_alb + Kalb_TDI*Aven_ub - Kelim*Aven_alb
# Venous Blood - Macromolecule-bound
dAven_mcr <- Qskn * Cskn_mcr + Qkid * Ckid_mcr  + Qc * Cart_mcr  - Qc * Cven_mcr   +
Kmcr_TDI*Aven_ub + Kelim*Aven_alb
# ========== SKIN COMPARTMENT ==========
#Dermal exposure
dDerm <- - SAderm*Dderm_ub
#Evaporation
#devap <- kevap*Asurf_ub
# Skin Surface - Unbound
dAsurf_ub <- SAderm*Dderm_ub - Qscve * Csurf_ub + Qscve * Cscve_ub #- kevap*Asurf_ub
# Skin Barrier - Unbound
dAscve_ub <- Qscve * Csurf_ub - Qscve * Cscve_ub - Kalb_scve * Ascve_ub - Pbld_scve*Qscve*Cscve_ub
# Skin Barrier - Albumin-bound
dAscve_alb <- Kalb_scve * Ascve_ub - Kelim * Ascve_alb
# Skin Barrier - Macromolecule-bound
dAscve_mcr <- Kelim * Ascve_alb - Pbld_scve*Qscve*Cscve_mcr
# Skin Tissue - Unbound
dAskn_ub <- Qskn * Cart_ub - Qskn * Cskn_ub + Pbld_scve*Qscve*Cscve_ub
# Skin Tissue - Macromolecule-bound
dAskn_mcr <- - Qskn * Cskn_mcr + Pbld_scve*Qscve*Cscve_mcr + Qskn * Cart_mcr
# ========== GUT COMPARTMENT ==========
# Gut Lumen (for oral exposure)
dAlum <- (1-Fabs)*inhalation - Kfeces*Alum
# ========== ELIMINATION PATHWAYS ==========
#Kidney Tissue - Unbound
dAkid_ub <- Qkid * Cart_ub - Qkid * Ckid_ub
#Kidney Tissue - Macromolecule-bound
dAkid_mcr <- Qkid * Cart_mcr - Qkid * Ckid_mcr - Qgfr*Cart_mcr
#Amine metabolite
dAuri_amine <- MWmet/MW * Qgfr*Ckid_mcr
# Urine elimination (albumin-bound + free in blood)
dAurine <- Qgfr*Cart_mcr - MWmet/MW * Qgfr*Ckid_mcr
# Feces elimination
dAfeces <- Kfeces*Alum
# ========== REMAINING COMPARTMENTS ==========
# Remaining tissues - Unbound
dArem_ub <- Qc * Cart_ub - Qc * Crem_ub
dVuri <- Qupr
dinhalation = 0
# Return derivatives grouped by organ
list(c('dAlung_int_ub' = dAlung_int_ub, 'dAlung_int_alb' = dAlung_int_alb, 'dAlung_int_mcr'=dAlung_int_mcr,
'dAlung_vas_ub'=dAlung_vas_ub, 'dAlung_vas_alb'=dAlung_vas_alb, 'dAlung_vas_mcr'=dAlung_vas_mcr,
'dAart_ub'=dAart_ub, 'dAart_alb'=dAart_alb, 'dAart_mcr'=dAart_mcr, 'dAven_ub'=dAven_ub,
'dAven_alb'=dAven_alb, 'dAven_mcr'=dAven_mcr, 'dDerm'=dDerm, 'dAsurf_ub'=dAsurf_ub, 'dAscve_ub'=dAscve_ub,
'dAscve_alb'=dAscve_alb, 'dAscve_mcr'=dAscve_mcr, 'dAskn_ub'=dAskn_ub, 'dAskn_mcr'=dAskn_mcr,
'dAlum'=dAlum, 'dAkid_ub'=dAkid_ub, 'dAkid_mcr'=dAkid_mcr, 'dAuri_amine'=dAuri_amine, 'dAurine'=dAurine,
'dAfeces'=dAfeces, 'dArem_ub'=dArem_ub, 'dVuri'=dVuri, 'dinhalation'=dinhalation
),
# Concentrations for output
'Clung_int_ub'=Clung_int_ub, 'Clung_int_alb'=Clung_int_alb, 'Clung_int_mcr'=Clung_int_mcr,
'Clung_vas_ub'=Clung_vas_ub, 'Clung_vas_alb'=Clung_vas_alb, 'Clung_vas_mcr'=dAlung_vas_mcr,
'Cart_ub'=Cart_ub, 'Cart_alb'=Cart_alb, 'Cart_mcr'=Cart_mcr,
'Cven_ub'=Cven_ub, 'Cven_alb'=Cven_alb, 'Cven_mcr'=Cven_mcr,
'Curine'=Curine,  'Curine_amine'=Curine_amine
)
})
}
#=============
#6. User input
#=============
#################################
#--------------------------------
# TDI occupational inhalation scenario
#--------------------------------
#################################
# Set up parameters for 8h occupational exposure
BW <- 85
Cair <- 0.020 #ug/L, 20 ug/m^3 TDI = 20 ug/1000L TDI
Qbr <- 1000 #breathing rate L/h
Fabs <- 0.2 #fraction absorbed
occup_inhalation_per_hour <- Qbr * Cair # ug/h
# Create exposure pattern: total dose at hour 0, then zero until next day
hours_per_day <- 24
days <- 180
# Create time vector for multiple days
time_hours <- seq(0, days * hours_per_day - 1, by = 8)
create_exposure_events <- function(days) {
time_points <- c()
inhalation_rates <- c()
for (day in 0:(days-1)) {
day_of_week <- day %% 7  # 0=Monday, 1=Tuesday, ..., 6=Sunday
# Only expose on weekdays (Monday-Friday: day_of_week 0-4)
if (day_of_week < 5) {  # Weekdays only
# Start of work (8am): set inhalation to 20 ug/h
work_start <- day * 24
time_points <- c(time_points, work_start)
inhalation_rates <- c(inhalation_rates, occup_inhalation_per_hour)
# End of work (4pm): set inhalation to 0 ug/h
work_end <- day * 24 + 8
time_points <- c(time_points, work_end)
inhalation_rates <- c(inhalation_rates, 0)
}
}
return(list(time = time_points, inhalation = inhalation_rates))
}
# Generate exposure data
exposure_events <- create_exposure_events(days)
inhalation_time <- exposure_events$time
inhalation <- exposure_events$inhalation
Ccreat <- 1 # g/L
user_input <- list('BW'=BW,
"inhalation"= inhalation,
"inhalation_time"=inhalation_time,
"Fabs"=Fabs)
params <- create.params(user_input)
inits <- create.inits(params)
events <- create.events(params)
# sample_time: a vector of time points to solve the ODEs for full week
sample_time=seq(0, 4368, 1)  #h
# ode(): The solver of the ODEs
solution <- data.frame(ode(times = sample_time,  func = ode.func,
y = inits, parms = params,
events = events,
method="lsodes",rtol = 1e-07, atol = 1e-07))
setwd("Scholten et al.2023/Data")
datapoints <-  openxlsx::read.xlsx("example.xlsx")
colnames(datapoints)[c(2,3)] <- c("time", "concentration")
column_names <- c("Curine_amine")
ggplot(solution, aes(x = time, y = Curine_amine)) +
geom_line() +
geom_point(data = datapoints, aes(x = time, y= concentration))+
#xlim(4200, 4368) +
theme_minimal()   # Set a minimal theme
