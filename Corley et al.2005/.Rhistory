#2. Function to create initial values for ODEs
#===============================================
create.inits <- function(parameters){
with(as.list(parameters),{
A_ven_EG <- 0; A_ven_GA <- 0; A_art_EG <-0; A_art_GA <-0;
A_lung_EG <- 0 ; A_liver_EG <- 0; A_kidney_EG <- 0; A_fat_EG <- 0; A_skin_EG <- 0;
A_GI_EG <- 0; A_rich_EG <- 0; A_slow_EG <- 0; A_liver_GA <- 0;
A_kidney_GA <- 0; A_fat_GA <- 0; A_skin_GA <- 0; A_GI_GA <- 0; A_rich_GA <- 0;
A_slow_GA <- 0; A_tubule_GA <- 0; Cum_urine_EG <- 0;
Cum_urine_GA <- 0; Cum_met_GA <-0;
inhalation <- 0; ingestion <-0; skin_absorption <-0
return(c(  'A_ven_EG'= A_ven_EG, 'A_ven_GA'= A_ven_GA,
'A_art_EG'= A_art_EG, 'A_art_GA'= A_art_GA,
'A_lung_EG'= A_lung_EG, 'A_liver_EG'= A_liver_EG,
'A_kidney_EG'= A_kidney_EG, 'A_fat_EG'= A_fat_EG, 'A_skin_EG'= A_skin_EG,
'A_GI_EG'= A_GI_EG, 'A_rich_EG'= A_rich_EG, 'A_slow_EG'= A_slow_EG,
'A_liver_GA'= A_liver_GA, 'A_kidney_GA'= A_kidney_GA,
'A_fat_GA'= A_fat_GA, 'A_skin_GA'= A_skin_GA,
'A_GI_GA'= A_GI_GA, 'A_rich_GA'= A_rich_GA, 'A_slow_GA'= A_slow_GA,
'A_tubule_GA'= A_tubule_GA,'Cum_urine_EG'= Cum_urine_EG,
'Cum_urine_GA'= Cum_urine_GA, 'Cum_met_GA'= Cum_met_GA,
'inhalation'=inhalation, 'ingestion'=ingestion, 'skin_absorption'=skin_absorption
))
})
}
#================================================================================================
#===================
#3. Events function
#===================
create.events <- function(parameters){
with(as.list(parameters), {
ldose <- length(inhalation)
ltimes <- length(inhalation_time)
# If not equal, then stop
if (ltimes != ldose){
stop("The times of administration should be equal in number to the doses")
}else{
if (admin.type == "inh"){
events <- list(data = data.frame(var = c("inhalation"),  time = inhalation_time,
value = inhalation, method = c("rep")) )
}else if (admin.type == "oral"){
events <- list(data = data.frame(var = c("ingestion"),  time = ingestion_time,
value = admin.dose, method = c("rep")) )
}else if (admin.type == "dermal"){
events <- list(data = data.frame(var = c("skin_absorption"),  time = skin_absorption.time,
value = admin.dose, method = c("rep")) )
}
}
return(events)
})
}
#================================================================================================
#==================
#4. Custom function
#==================
custom.func <- function(){
return()
}
# ============================================================================
#5. ODEs System
# ============================================================================
ode.func <- function(time, inits, params, custom.func){
with(as.list(c(inits, params)),{
# Calculate tissue concentrations (mg/L)
#========================================================================================
C_lung_EG <- A_lung_EG / VluC
C_liver_EG <- A_liver_EG / VLC
C_kidney_EG <- A_kidney_EG / VKC
C_fat_EG <- A_fat_EG / VFC
C_skin_EG <- A_skin_EG / VSKC
C_GI_EG <- A_GI_EG / VGIC
C_rich_EG <- A_rich_EG / VRC
C_slow_EG <- A_slow_EG / VSC
C_ven_EG <- A_ven_EG/VVen
C_art_EG <- A_art_EG/VArt
C_plasma_EG <- (A_ven_EG + A_art_EG)/VBC
C_liver_GA <- A_liver_GA / VLC
C_kidney_GA <- A_kidney_GA / VKC
C_fat_GA <- A_fat_GA / VFC
C_skin_GA <- A_skin_GA / VSKC
C_GI_GA <- A_GI_GA / VGIC
C_rich_GA <- A_rich_GA / VRC
C_slow_GA <- A_slow_GA / VSC
C_tubule_GA <- A_tubule_GA / V_tubule
C_ven_GA <- A_ven_GA/VVen
C_art_GA <- A_art_GA/VArt
C_plasma_GA <- (A_ven_GA + A_art_GA)/VBC
#ODEs
#========================================================================================
#Venous blood
dA_ven_EG <- (QLC+QGIC) * C_liver_EG / PL_EG + QKC * C_kidney_EG / PK_EG + QFC * C_fat_EG / PF_EG +
QSKC * C_skin_EG / PSK_EG + QRC * C_rich_EG / PR_EG + QSC * C_slow_EG / PS_EG -
QC * C_ven_EG
dA_ven_GA <- (QLC+QGIC) * C_liver_GA / PL_GA + QKC * C_kidney_GA / PK_GA + QFC * C_fat_GA / PF_GA +
QSKC * C_skin_GA / PSK_GA + QRC * C_rich_GA / PR_GA + QSC * C_slow_GA / PS_GA -
QC * C_ven_GA
#Arterial blood
dA_art_EG <- QC * C_lung_EG / PLu_EG - QLC * C_art_EG - QKC * C_art_EG - QFC * C_art_EG -
QSKC * C_art_EG - QGIC * C_art_EG - QRC * C_art_EG - QSC * C_art_EG -
CL_renal * C_art_EG - GFR * C_art_GA
dA_art_GA <- QC * C_ven_GA - QLC * C_art_GA - QKC * C_art_GA - QFC * C_art_GA -
QSKC * C_art_GA - QGIC * C_art_GA - QRC * C_art_GA - QSC * C_art_GA
# Differential equations for EG compartments
dA_lung_EG <- inhalation + QC * C_ven_EG - QC * C_lung_EG / PLu_EG
dA_liver_EG <- QLC * C_art_EG - (QLC+QGIC) * C_liver_EG / PL_EG -
(VMAX1 * C_liver_EG) / (KM1_mg + C_liver_EG) + QGIC * C_GI_EG / PGI_EG
dA_kidney_EG <- QKC * C_art_EG - QKC * C_kidney_EG / PK_EG
dA_fat_EG <- QFC * C_art_EG - QFC * C_fat_EG / PF_EG
dA_skin_EG <- skin_absorption + QSKC * C_art_EG - QSKC * C_skin_EG / PSK_EG
dA_GI_EG <- QGIC * C_art_EG - QGIC * C_GI_EG / PGI_EG
dA_rich_EG <- QRC * C_art_EG - QRC * C_rich_EG / PR_EG
dA_slow_EG <- QSC * C_art_EG - QSC * C_slow_EG / PS_EG
# Differential equations for GA compartments
dA_liver_GA <- QLC * C_art_GA - (QLC+QGIC) * C_liver_GA / PL_GA + QGIC * C_GI_GA / PGI_GA +
(VMAX1 * C_liver_EG) / (KM1_mg + C_liver_EG) - (VMAX2 * C_liver_GA) / (KM2_mg + C_liver_GA)
dA_kidney_GA <- QKC * C_art_GA - QKC * C_kidney_GA / PK_GA + (TMAX * C_tubule_GA) / (KT + C_tubule_GA)
dA_fat_GA <- QFC * C_art_GA - QFC * C_fat_GA / PF_GA
dA_skin_GA <- QSKC * C_art_GA - QSKC * C_skin_GA / PSK_GA
dA_GI_GA <- ingestion + QGIC * C_art_GA - QGIC * C_GI_GA / PGI_GA
dA_rich_GA <- QRC * C_art_GA - QRC * C_rich_GA / PR_GA
dA_slow_GA <- QSC * C_art_GA - QSC * C_slow_GA / PS_GA
# Tubule urine GA
dA_tubule_GA <- GFR * C_art_GA - (TMAX * C_tubule_GA) / (KT + C_tubule_GA) - Q_urine * C_tubule_GA
# Cumulative amounts
dCum_urine_EG <- CL_renal * C_art_EG
dCum_urine_GA <- Q_urine * C_tubule_GA
dCum_met_GA <- (VMAX2 * C_liver_GA) / (KM2_mg + C_liver_GA)
dinhalation = 0
dingestion = 0
dskin_absorption = 0
# Return derivatives and concentrations
return(list(c('dA_ven_EG'=dA_ven_EG, 'dA_ven_GA'=dA_ven_GA,
'dA_art_EG'=dA_art_EG, 'dA_art_GA'=dA_art_GA,
'dA_lung_EG'=dA_lung_EG, 'dA_liver_EG'=dA_liver_EG,
'dA_kidney_EG'=dA_kidney_EG, 'dA_fat_EG'=dA_fat_EG, 'dA_skin_EG'=dA_skin_EG,
'dA_GI_EG'=dA_GI_EG, 'dA_rich_EG'=dA_rich_EG, 'dA_slow_EG'=dA_slow_EG,
'dA_liver_GA'=dA_liver_GA, 'dA_kidney_GA'=dA_kidney_GA,
'dA_fat_GA'=dA_fat_GA, 'dA_skin_GA'=dA_skin_GA,
'dA_GI_GA'=dA_GI_GA, 'dA_rich_GA'=dA_rich_GA, 'dA_slow_GA'=dA_slow_GA,
'dA_tubule_GA'=dA_tubule_GA,'dCum_urine_EG'=dCum_urine_EG,
'dCum_urine_GA'=dCum_urine_GA, 'dCum_met_GA'=dCum_met_GA,
'dinhalation'=dinhalation, 'dingestion'=dingestion,
'dskin_absorption'=dskin_absorption),
'C_lung_EG' = C_lung_EG, 'C_liver_EG' = C_liver_EG, 'C_kidney_EG' = C_kidney_EG,
'C_fat_EG' = C_fat_EG, 'C_skin_EG' = C_skin_EG, 'C_GI_EG' = C_GI_EG,
'C_rich_EG' = C_rich_EG, 'C_slow_EG' = C_slow_EG,
'C_liver_GA' = C_liver_GA, 'C_kidney_GA' = C_kidney_GA, 'C_fat_GA' = C_fat_GA,
'C_skin_GA' = C_skin_GA, 'C_GI_GA' = C_GI_GA, 'C_rich_GA' = C_rich_GA,
'C_slow_GA' = C_slow_GA, 'C_tubule_GA' = C_tubule_GA,
'C_art_EG' = C_art_EG, 'C_art_GA' = C_art_GA, 'C_ven_EG' = C_ven_EG,
'C_ven_GA' = C_ven_GA, 'C_plasma_EG'=C_plasma_EG, 'C_plasma_GA'=C_plasma_GA
))
})
}
#=============
#6. User input
#=============
################################################################################
setwd("Corley et al.2005/Data")
# Read data
EG_vol1_plasma <- openxlsx::read.xlsx("EGvol1_plasma_fit.xlsx")
GA_vol1_plasma <- openxlsx::read.xlsx("GAvol1_plasma_fit.xlsx")
EG_vol1_urine <- openxlsx::read.xlsx("EGvol1_urine_fit.xlsx")
GA_vol1_urine <- openxlsx::read.xlsx("GAvol1_urine_fit.xlsx")
setwd("Corley et al.2005")
dataset <- list("df1" = EG_vol1_plasma, "df2" = GA_vol1_plasma,
"df3" = EG_vol1_urine,  "df4" = GA_vol1_urine)
#################################
#--------------------------------
# EG inhalation scenario - volunteer 1
#--------------------------------
#################################
# Set up parameters for event-based exposure
BW <- 96
admin.dose_peg_kg <- 0.96 # mg/kg BW
admin.dose_total <- admin.dose_peg_kg * BW   # total mg
admin.type <- "inh"
n_inj <- 16
interval_min <- 15
interval_h <- interval_min / 60
eps_h <- 0.01
# injection times every 15 min
inj_times_h <- seq(0, by = interval_h, length.out = n_inj)
# mg per injection
dose_per_inj_mg <- admin.dose_total / n_inj
# convert to mg/h rate over 15 min interval
dose_per_inj_rate <- dose_per_inj_mg / interval_h  # e.g. 23.04 mg/h
times_raw  <- as.vector(rbind(inj_times_h, inj_times_h + interval_h - eps_h))
values_raw <- as.vector(rbind(rep(dose_per_inj_rate, n_inj), rep(0, n_inj)))
# Round to match your printed format
inhalation_time <- round(times_raw, 2)
inhalation      <- round(values_raw, 2)
ingestion <-0
ingestion_time <-0
skin_absorption <-0
skin_absorption_time <-0
sex <- "M"
user_input <- list('BW'=BW,
"admin.type"=admin.type,
"inhalation"= inhalation,
"ingestion"=ingestion,
"skin_absorption"=skin_absorption,
"inhalation_time" = inhalation_time,
"ingestion_time"=ingestion_time,
"skin_absorption_time"=skin_absorption_time,
"sex" = sex)
params <- create.params(user_input)
inits <- create.inits(params)
events <- create.events(params)
# sample_time: a vector of time points to solve the ODEs for full week
sample_time=seq(0, 16, 0.1)  #h
# ode(): The solver of the ODEs
solution <- data.frame(ode(times = sample_time,  func = ode.func,
y = inits, parms = params,
events = events,
method="lsodes",rtol = 1e-07, atol = 1e-07))
# We need to keep only the predictions for the relevant compartments for the time points
# at which we have available data.
#======================================df1=========================================================
exp_data <- dataset$df1
colnames(exp_data)[c(2,3)] <- c("time", "concentration")
column_names <- c("C_plasma_EG")
preds_EG_vol1_plasma <- list()
for (i in 1:length(unique(exp_data$Tissue))) {
compartment <- unique(exp_data$Tissue)[i]
#Retrieve time points at which measurements are available for compartment i
exp_time <- exp_data[exp_data$Tissue == compartment, 2]
preds_EG_vol1_plasma [[i]] <- solution[solution$time %in% exp_time, column_names[i]]} #mg/L
obs_EG_vol1_plasma <- list(exp_data[exp_data$Tissue == "Plasma", "concentration"]) #mg/L
#======================================df2=========================================================
exp_data <- dataset$df2
colnames(exp_data)[c(2,3)] <- c("time", "concentration")
column_names <- c("C_plasma_GA")
preds_GA_vol1_plasma <- list()
for (i in 1:length(unique(exp_data$Tissue))) {
compartment <- unique(exp_data$Tissue)[i]
#Retrieve time points at which measurements are available for compartment i
exp_time <- exp_data[exp_data$Tissue == compartment, 2]
preds_GA_vol1_plasma [[i]] <- solution[solution$time %in% exp_time, column_names[i]]} #mg/L
obs_GA_vol1_plasma <- list(exp_data[exp_data$Tissue == "Plasma", "concentration"]) #mg/L
#======================================df3=========================================================
# sample_time: a vector of time points to solve the ODEs for full week
sample_time=seq(0, 20, 0.1)  #h
# ode(): The solver of the ODEs
solution <- data.frame(ode(times = sample_time,  func = ode.func,
y = inits, parms = params,
events = events,
method="lsodes",rtol = 1e-07, atol = 1e-07))
exp_data <- dataset$df3
colnames(exp_data)[c(2,3)] <- c("time", "amount")
column_names <- c("Cum_urine_EG")
preds_EG_vol1_urine <- list()
for (i in 1:length(unique(exp_data$Tissue))) {
compartment <- unique(exp_data$Tissue)[i]
#Retrieve time points at which measurements are available for compartment i
exp_time <- exp_data[exp_data$Tissue == compartment, 2]
preds_EG_vol1_urine [[i]] <- solution[solution$time %in% exp_time, column_names[i]]} #mg/L
obs_EG_vol1_urine <- list(exp_data[exp_data$Tissue == "Urine", "amount"]) #mg/L
#======================================df4=========================================================
exp_data <- dataset$df4
colnames(exp_data)[c(2,3)] <- c("time", "amount")
column_names <- c("Cum_urine_GA")
preds_GA_vol1_urine <- list()
for (i in 1:length(unique(exp_data$Tissue))) {
compartment <- unique(exp_data$Tissue)[i]
#Retrieve time points at which measurements are available for compartment i
exp_time <- exp_data[exp_data$Tissue == compartment, 2]
preds_GA_vol1_urine [[i]] <- solution[solution$time %in% exp_time, column_names[i]]} #mg/L
obs_GA_vol1_urine <- list(exp_data[exp_data$Tissue == "Urine", "amount"]) #mg/L
#Simulations and plots
################################################################################
#EG inhalation scenario - volunteer 1
################################################################################
# Set up parameters for event-based exposure
BW <- 96
admin.dose_peg_kg <- 0.96 # mg/kg BW
admin.dose_total <- admin.dose_peg_kg * BW   # total mg
admin.type <- "inh"
n_inj <- 16
interval_min <- 15
interval_h <- interval_min / 60
eps_h <- 0.01
# injection times every 15 min
inj_times_h <- seq(0, by = interval_h, length.out = n_inj)
# mg per injection
dose_per_inj_mg <- admin.dose_total / n_inj
# # convert to mg/h rate over 15 min interval
dose_per_inj_rate <- dose_per_inj_mg / interval_h  # e.g. 23.04 mg/h
times_raw  <- as.vector(rbind(inj_times_h, inj_times_h + interval_h - eps_h))
values_raw <- as.vector(rbind(rep(dose_per_inj_rate, n_inj), rep(0, n_inj)))
# Round to match your printed format
inhalation_time <- round(times_raw, 2)
inhalation      <- round(values_raw, 2)
ingestion <-0
ingestion_time <-0
skin_absorption <-0
skin_absorption_time <-0
sex <- "M"
user_input <- list('BW'=BW,
"admin.type"=admin.type,
"inhalation"= inhalation,
"ingestion"=ingestion,
"skin_absorption"=skin_absorption,
"inhalation_time" = inhalation_time,
"ingestion_time"=ingestion_time,
"skin_absorption_time"=skin_absorption_time,
"sex" = sex)
params <- create.params(user_input)
inits <- create.inits(params)
events <- create.events(params)
# sample_time: a vector of time points to solve the ODEs for full week
sample_time=seq(0, 16, 0.1)  #h
# ode(): The solver of the ODEs
solution <- data.frame(ode(times = sample_time,  func = ode.func,
y = inits, parms = params,
events = events,
method="lsodes",rtol = 1e-07, atol = 1e-07))
preds_EG_vol1_plasma <- solution[, c("time","C_plasma_EG")]
preds_GA_vol1_plasma <- solution[, c("time","C_plasma_GA")]
# sample_time: a vector of time points to solve the ODEs for full week
sample_time=seq(0, 20, 0.1)  #h
# ode(): The solver of the ODEs
solution <- data.frame(ode(times = sample_time,  func = ode.func,
y = inits, parms = params,
events = events,
method="lsodes",rtol = 1e-07, atol = 1e-07))
preds_EG_vol1_urine <- solution[, c("time","Cum_urine_EG")]
preds_GA_vol1_urine <- solution[, c("time","Cum_urine_GA")]
# ######################################################################################
#Plot the predictions against the observations
library(ggplot2)
# Function that creates a plot given a compartment name and the respective predictions and observations
create.plots_concentration <- function(predictions, observations, compartment){
#Colours of observations and predictions
cls <-  c("predictions" = "#56B4E9",  "Observations" = "#D55E00")
ggplot(data = predictions)+
geom_line( aes_string(x= "Time", y= rlang::expr(!!compartment),
color = '"predictions"'),  size=1.5,alpha = 0.7) +
geom_point(data=observations, aes_string(x="Time", y= rlang::expr(!!compartment),
color='"Observations"'), size=4)+
labs(title = rlang::expr(!!compartment),
y = expression("Plasma concentration (mg/L)" ),
x = "Time (hours)")+
theme(plot.title = element_text(hjust = 0.5))+
scale_color_manual("", values=cls,
guide = guide_legend(override.aes =
list(shape = c(16,NA),
linetype = c(0,1))))+
theme_light() +
theme(legend.position=c(1,1),
legend.justification=c(0, 1),
legend.key.size = unit(1.5, 'cm'),
legend.title = element_text(size=14),
axis.title=element_text(size=14),
legend.text = element_text(size=14)
)
}
# Convert TDI_urine_data from long to wide format using reshape
experiment1 <- reshape(EG_vol1_plasma[c("Tissue" ,"Time_(h)",
"Concentration_(mg/L)")],
idvar = "Time_(h)", timevar = "Tissue", direction = "wide")
colnames(experiment1) <- c("Time",unique(EG_vol1_plasma$Tissue))
experiment2 <- reshape(GA_vol1_plasma[c("Tissue" ,"Time_(h)",
"Concentration_(mg/L)")],
idvar = "Time_(h)", timevar = "Tissue", direction = "wide")
colnames(experiment2) <- c("Time",unique(GA_vol1_plasma$Tissue))
# Put the experiments in a list
experiments <- list(experiment1 = experiment1, experiment2 = experiment2)
# Rename predictions so that they share the same name as the names of the experimental data
colnames(preds_EG_vol1_plasma) <- c( "Time", "Plasma")
colnames(preds_GA_vol1_plasma) <- c( "Time", "Plasma")
# Create a list containing the corresponding predictions
simulations <- list(predictions1 = preds_EG_vol1_plasma, predictions2 = preds_GA_vol1_plasma)
# Iterate over all existing experiments and create the accompanying plots
for(i in 1:length(experiments)){
# Retrieve the corresponding observations and simulations
observations <- experiments[[i]]
predictions <- simulations[[i]]
# Extract the compartment names
compartments <- names(predictions)[2:length(predictions)]
# Use lapply to iterate over the column names and create plots
plots <- lapply(compartments, function(compartment) {
create.plots_concentration(predictions, observations, compartment )
})
if(length(compartments) == 1){
final_plot <- do.call(ggpubr::ggarrange, c(plots, ncol = 1, nrow = 1,
common.legend = TRUE, legend = "right"))
}else{
final_plot <- do.call(ggpubr::ggarrange, c(plots, ncol = 3, nrow = ceiling(length(plots) / 3),
common.legend = TRUE, legend = "right"))
}
plot.margin=unit(c(0,0,0,0), "pt")
# Save the plot with dynamically adjusted dimensions
ggsave(paste0("experiment_plasma", i,".png"), plot = final_plot,
device = 'png', dpi = 300,
width = 13,
height = 10,
units = "in")
}
create.plots_amount <- function(predictions, observations, compartment){
#Colours of observations and predictions
cls <-  c("predictions" = "#56B4E9",  "Observations" = "#D55E00")
ggplot(data = predictions)+
geom_line( aes_string(x= "Time", y= rlang::expr(!!compartment),
color = '"predictions"'),  size=1.5,alpha = 0.7) +
geom_point(data=observations, aes_string(x="Time", y= rlang::expr(!!compartment),
color='"Observations"'), size=4)+
labs(title = rlang::expr(!!compartment),
y = expression("Urine cumulative amount (mg)" ),
x = "Time (hours)")+
theme(plot.title = element_text(hjust = 0.5))+
scale_color_manual("", values=cls,
guide = guide_legend(override.aes =
list(shape = c(16,NA),
linetype = c(0,1))))+
theme_light() +
theme(legend.position=c(1,1),
legend.justification=c(0, 1),
legend.key.size = unit(1.5, 'cm'),
legend.title = element_text(size=14),
axis.title=element_text(size=14),
legend.text = element_text(size=14)
)
}
# Convert TDI_urine_data from long to wide format using reshape
experiment3 <- reshape(EG_vol1_urine[c("Tissue" ,"Time_(h)",
"Amount_mg")],
idvar = "Time_(h)", timevar = "Tissue", direction = "wide")
colnames(experiment3) <- c("Time",unique(EG_vol1_urine$Tissue))
experiment4 <- reshape(GA_vol1_urine[c("Tissue" ,"Time_(h)",
"Amount_mg")],
idvar = "Time_(h)", timevar = "Tissue", direction = "wide")
colnames(experiment4) <- c("Time",unique(GA_vol1_urine$Tissue))
# Put the experiments in a list
experiments <- list(experiment3 = experiment3, experiment4 = experiment4)
# Rename predictions so that they share the same name as the names of the experimental data
colnames(preds_EG_vol1_urine) <- c( "Time", "Urine")
colnames(preds_GA_vol1_urine) <- c( "Time", "Urine")
# Create a list containing the corresponding predictions
simulations <- list(predictions3 = preds_EG_vol1_urine, predictions3 = preds_GA_vol1_urine)
# Iterate over all existing experiments and create the accompanying plots
for(i in 1:length(experiments)){
# Retrieve the corresponding observations and simulations
observations <- experiments[[i]]
predictions <- simulations[[i]]
# Extract the compartment names
compartments <- names(predictions)[2:length(predictions)]
# Use lapply to iterate over the column names and create plots
plots <- lapply(compartments, function(compartment) {
create.plots_amount(predictions, observations, compartment )
})
if(length(compartments) == 1){
final_plot <- do.call(ggpubr::ggarrange, c(plots, ncol = 1, nrow = 1,
common.legend = TRUE, legend = "right"))
}else{
final_plot <- do.call(ggpubr::ggarrange, c(plots, ncol = 3, nrow = ceiling(length(plots) / 3),
common.legend = TRUE, legend = "right"))
}
plot.margin=unit(c(0,0,0,0), "pt")
# Save the plot with dynamically adjusted dimensions
ggsave(paste0("experiment_urine", i,".png"), plot = final_plot,
device = 'png', dpi = 300,
width = 13,
height = 10,
units = "in")
}
# ====================
# Upload on Jaqpot
# ===================
# Subset of features to be displayed on the user interface
predicted.feats <- c("A_ven_EG", "A_art_EG","A_lung_EG", "A_liver_EG",
"A_kidney_EG", "A_fat_EG", "A_skin_EG", "A_GI_EG",
"A_rich_EG", "A_slow_EG",
"A_ven_GA",  "A_art_GA", "A_liver_GA", "A_kidney_GA",
"A_fat_GA", "A_skin_GA" , "A_GI_GA", "A_rich_GA",
"A_slow_GA", "A_tubule_GA",
"Cum_urine_EG", "Cum_urine_GA","Cum_met_GA",
"C_ven_EG", "C_art_EG", "C_lung_EG", "C_liver_EG",
"C_kidney_EG","C_fat_EG", "C_skin_EG", "C_GI_EG",
"C_rich_EG", "C_slow_EG",
"C_ven_GA","C_art_GA", "C_liver_GA", "C_kidney_GA",
"C_fat_GA","C_skin_GA", "C_GI_GA",
"C_rich_GA","C_slow_GA", "C_tubule_GA",
"C_plasma_EG", "C_plasma_GA")
setwd("Corley et al.2005")
jaqpotr::deploy.pbpk(user.input = user_input,out.vars = predicted.feats,
create.params = create.params,  create.inits = create.inits,
create.events = create.events, custom.func = custom.func,
envFile = "/Users/eviepapakyriakopoulou/Documents/Documents/NTUA Post-Doc/INSIGHT/jaqpotkeys/keys.env")
inhalation
# Set up parameters for event-based exposure
BW <- 96
admin.dose_peg_kg <- 0.96 # mg/kg BW
admin.dose_total <- admin.dose_peg_kg * BW   # total mg
n_inj <- 16
interval_min <- 15
interval_h <- interval_min / 60
eps_h <- 0.01
# injection times every 15 min
inj_times_h <- seq(0, by = interval_h, length.out = n_inj)
# mg per injection
dose_per_inj_mg <- admin.dose_total / n_inj
# convert to mg/h rate over 15 min interval
dose_per_inj_rate <- dose_per_inj_mg / interval_h  # e.g. 23.04 mg/h
times_raw  <- as.vector(rbind(inj_times_h, inj_times_h + interval_h - eps_h))
values_raw <- as.vector(rbind(rep(dose_per_inj_rate, n_inj), rep(0, n_inj)))
# Round to match your printed format
inhalation_time <- round(times_raw, 2)
inhalation      <- round(values_raw, 2)
sex <- "M"
inhalation
inhalation_time
